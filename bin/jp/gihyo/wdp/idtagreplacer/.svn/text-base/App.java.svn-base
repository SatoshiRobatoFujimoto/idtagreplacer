package jp.gihyo.wdp.idtagreplacer;

import java.util.LinkedList;
import java.util.NoSuchElementException;
import java.util.logging.Logger;

public class App {
	private static App instance = new App();
	
	/**
	 * アプリケーションが利用する出力用オブジェクトを保持します。
	 */
	public static Printer out = null;
	
	/**
	 * 現在有効な段落タグを保持します。
	 * これはリストとして実装されていますが、現状、単純なスタックのように動作しています。
	 * アプリケーションは起動時、タグ設定ファイルを読み込んだ際に、
	 * まずこのリストに「デフォルトの段落スタイル」を登録します。
	 * その後、処理対象のテキストファイルを読み込みながら、
	 * 段落の開始記号が出現するたびに、このリストに対応する段落スタイルをpushし、
	 * 終了記号が出現するたびに、popします。
	 */
	private LinkedList<ParagraphTag> activeParagraphTag = null;
	
	/**
	 * 段落編集記号のリストを保持します。
	 * タグ設定ファイルに記述された内容が、パーサを通じてここに格納されます。
	 */
	private LinkedList<ParagraphSign> paragraphSigns = null;
	
	/**
	 * 文字編集記号のリストを保持します。
	 * タグ設定ファイルに記述された内容が、パーサを通じてここに格納されます。
	 */
	private LinkedList<CharacterSign> characterSigns = null;
	
	/**
	 * 自由置換編集記号のリストを保持します。
	 * タグ設定ファイルに記述された内容が、パーサを通じてここに格納されます。
	 */
	private LinkedList<ReplaceSign> replaceSigns = null;
	
	private App() {
		activeParagraphTag = new LinkedList<ParagraphTag>() {
			private static final long serialVersionUID = 1925385660123868542L;

			public boolean add(ParagraphTag o) {
				Logger.global.info("現在の段落タグとして、'" + o.getTagName() + "'が登録されました。");
				return super.add(o);
			}
			
			public ParagraphTag removeLast() throws NoSuchElementException {
				ParagraphTag ret = super.removeLast();
				Logger.global.info("現在の段落タグから'" + ret.getTagName() + "'を取り除きました。");
				return ret;
			}
		};
		
		paragraphSigns = new LinkedList<ParagraphSign>();
		
		characterSigns = new LinkedList<CharacterSign>();
		
		replaceSigns = new LinkedList<ReplaceSign>();
	}
	
	public LinkedList<ParagraphTag> getActiveParagraphTag() {
		return activeParagraphTag;
	}
	
	public LinkedList<ParagraphSign> getParagraphSigns() {
		return paragraphSigns;
	}
	
	public LinkedList<CharacterSign> getCharacterSigns() {
		return characterSigns;
	}
	
	public LinkedList<ReplaceSign> getReplaceSigns() {
		return replaceSigns;
	}
	
	public static App getInstance() {
		if (instance == null) instance = new App();
		return instance;
	}
}
